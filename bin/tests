#!/bin/bash
set -xeo pipefail
dropdb --if-exists ledger; createdb ledger
cd $CHAIN/sdk/ruby
gem install bundler --conservative
bundle check || bundle install
bundle exec appraisal install
LEGACY_VERSION=1.0.4 \
  with-ledgerd bundle exec appraisal v1.0.4 \
  rspec "$@" --exclude-pattern "spec/**/1.{1,2}/*.rb"
LEGACY_VERSION=1.1.0 \
  with-ledgerd bundle exec appraisal v1.1.0 \
  rspec "$@" --exclude-pattern "spec/**/1.2/*.rb"
with-ledgerd bundle exec appraisal current-checkout rspec "$@"
